---
title: æ³¨å†Œè¡¨è„šæœ¬
description: äº†è§£å¦‚ä½•ä½¿ç”¨æ³¨å†Œè¡¨è„šæœ¬ç®€åŒ–åœ¨ Nuxt è„šæœ¬ä¸­é›†æˆç¬¬ä¸‰æ–¹è„šæœ¬ã€‚
---

æ³¨å†Œè¡¨è„šæœ¬é€šè¿‡ç®€åŒ–åœ¨ Nuxt è„šæœ¬ä¸­é›†æˆç¬¬ä¸‰æ–¹è„šæœ¬ï¼Œæå‡å¼€å‘è€…ä½“éªŒã€‚

æ”¯æŒçš„æ³¨å†Œè¡¨è„šæœ¬åˆ—è¡¨ï¼Œè¯·å‚è§ [è„šæœ¬æ³¨å†Œè¡¨](/scripts) åˆ—è¡¨ã€‚

## ç‰¹æ€§

### ğŸ˜Œ å®‰å…¨åˆå§‹åŒ–

è®¸å¤šç¬¬ä¸‰æ–¹è„šæœ¬éœ€è¦åœ¨åŠ è½½è„šæœ¬å‰åˆå§‹åŒ–ä¸€äº›å…¨å±€çŠ¶æ€ï¼ŒNuxt è„šæœ¬ä¼šä»¥ä¼˜åŒ–çš„æ–¹å¼å¸®ä½ å¤„ç†è¿™ä¸€è¿‡ç¨‹ã€‚

### ğŸï¸ ç»†ç²’åº¦æ€§èƒ½è°ƒä¼˜

æ¯ä¸ªæ³¨å†Œè¡¨è„šæœ¬éƒ½ç»è¿‡ä¼˜åŒ–ï¼Œä»¥å°½å¯èƒ½é«˜æ•ˆçš„æ–¹å¼åŠ è½½è„šæœ¬åŠŸèƒ½ã€‚

### ğŸ“œ å®Œå…¨ç±»å‹åŒ–

å¤„ç†ç¬¬ä¸‰æ–¹è„šæœ¬é€šå¸¸éœ€è¦è‡ªè¡Œå¤„ç†å®ƒä»¬çš„ API ç±»å‹ã€‚æ³¨å†Œè¡¨è„šæœ¬é€šè¿‡æä¾›é¢„å®šä¹‰ç±»å‹æ¥ç¼“è§£è¿™ä¸€é—®é¢˜ï¼Œä½¿ä½ çš„é¡¹ç›®èƒ½å¤Ÿäº«å—ä»£ç è¡¥å…¨å’Œç±»å‹å®‰å…¨ã€‚

### âœ… é€‰é¡¹éªŒè¯

ä½¿ç”¨ [Valibot](https://github.com/fabian-hiller/valibot)ï¼Œæ³¨å†Œè¡¨è„šæœ¬è‡ªåŠ¨éªŒè¯ç¬¬ä¸‰æ–¹è„šæœ¬çš„é…ç½®é€‰é¡¹ï¼Œå¸®åŠ©ä½ åŠæ—©å‘ç°å¹¶è§£å†³é…ç½®é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬ä¼šæ£€æŸ¥ Cloudflare Web Analytics çš„ä»¤ç‰Œé•¿åº¦ã€‚

::code-group

```ts [Schema]
export const CloudflareWebAnalyticsOptions = object({
  /**
   * Cloudflare Web Analytics çš„ä»¤ç‰Œã€‚
   */
  token: string([minLength(32)]),
  /**
   * Cloudflare Web Analytics é€šè¿‡é‡å†™ History API çš„ pushState å‡½æ•°å’Œç›‘å¬ onpopstate è‡ªåŠ¨æµ‹é‡ SPAã€‚
   * ä¸æ”¯æŒåŸºäºå“ˆå¸Œçš„è·¯ç”±å™¨ã€‚
   *
   * @default true
   */
  spa: optional(boolean()),
})
```

```ts [ç¤ºä¾‹]
useScriptCloudflareWebAnalytics({
  token: '123', // ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¸æ˜¯ 32
})
```

::

å‡ºäºæ€§èƒ½è€ƒè™‘ï¼ŒéªŒè¯ä»…åœ¨å¼€å‘æ—¶è¿›è¡Œã€‚åœ¨ç”Ÿäº§æ„å»ºä¸­ä¼šè¢« tree-shake æ‰ã€‚

### ğŸ¤« è¿è¡Œæ—¶é…ç½®é›†æˆ

æ³¨å†Œè¡¨è„šæœ¬å¯ä»¥é€šè¿‡ `.env` æ–‡ä»¶é…ç½®ï¼Œå…è®¸ä½ ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç è„šæœ¬é€‰é¡¹ã€‚

::code-group

```text [.env]
NUXT_PUBLIC_SCRIPTS_CLOUDFLARE_WEB_ANALYTICS_TOKEN=YOUR_TOKEN
```

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  scripts: {
    registry: {
      // åŠ è½½è„šæœ¬
      cloudflareWebAnalytics: true,
    },
  },
  runtimeConfig: {
    public: {
      scripts: {
        cloudflareWebAnalytics: {
          // æä¾›ç©ºå­—ç¬¦ä¸²ä»¥ä½¿ .env ç”Ÿæ•ˆ
          token: '', // NUXT_PUBLIC_SCRIPTS_CLOUDFLARE_WEB_ANALYTICS_TOKEN
        },
      },
    },
  },
})
```

::

## ä½¿ç”¨

### åœ¨å¼€å‘ç¯å¢ƒä¸­ç¦ç”¨

å½“ä½ æƒ³åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨æš´éœ²çš„ API è„šæœ¬ï¼ˆä¾‹å¦‚ç»„ä»¶å†…è°ƒç”¨ `gtag`ï¼‰æ—¶ï¼Œä½ å¸Œæœ›åŠ è½½ä¸€ä¸ªæ¨¡æ‹Ÿç‰ˆæœ¬ï¼Œè¿™æ ·è„šæœ¬å°±æ°¸è¿œä¸ä¼šçœŸæ­£åŠ è½½ã€‚

ä½ å¯ä»¥é€šè¿‡ç»™æ³¨å†Œè¡¨è„šæœ¬æä¾›ä¸€ä¸ª `mock` å€¼æ¥å®ç°ã€‚

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  scripts: {
    registry: {
      googleTagManager: true,
    },
  },
  $development: {
    scripts: {
      registry: {
        googleTagManager: "mock",
      },
    },
  },
})
```

### åŠ è½½å¤šä¸ªç›¸åŒè„šæœ¬

ä½ å¯èƒ½æœ‰éœ€è¦ä½¿ç”¨ä¸åŒé…ç½®åŠ è½½åŒä¸€ä¸ªæ³¨å†Œè¡¨è„šæœ¬å¤šæ¬¡çš„æƒ…å†µã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¼šå»é‡ä¸”åªåŠ è½½ä¸€æ¬¡ã€‚è¦åŠ è½½åŒä¸€ä¸ªè„šæœ¬çš„å¤šä¸ªå®ä¾‹ï¼Œå¯ä»¥ç»™è„šæœ¬æä¾›å”¯ä¸€çš„ `key`ã€‚

```ts
const { proxy: gaOne } = useScriptGoogleAnalytics({
  id: 'G-TR58L0EF8P',
})

const { proxy: gaTwo } = useScriptGoogleAnalytics({
  // ä¸è®¾ç½® key ä¼šè¿”å›ç¬¬ä¸€ä¸ªè„šæœ¬å®ä¾‹
  key: 'gtag2',
  id: 'G-1234567890',
})
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä¿®æ”¹ key æ—¶ï¼Œä½ ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ä¼šå¤±æ•ˆã€‚

ä¾‹å¦‚ï¼Œå°† key è®¾ç½®ä¸º `gtag2`ï¼Œä½ éœ€è¦æŒ‰å¦‚ä¸‹æ–¹å¼æä¾›è¿è¡Œæ—¶é…ç½®ï¼š

```ts
export default defineNuxtConfig({
  runtimeConfig: {
    public: {
      scripts: {
        gtag2: {
          id: '', // NUXT_PUBLIC_SCRIPTS_GTAG2_ID
        },
      },
    },
  },
})
```

### ä½¿ç”¨è„šæœ¬é€‰é¡¹å’Œè„šæœ¬è¾“å…¥

æ³¨å†Œè¡¨è„šæœ¬ä¸ä¼šé˜»æ­¢ä½ ä½¿ç”¨æ ¸å¿ƒçš„ `useScript` åŠŸèƒ½ï¼Œä½ å¯ä»¥é€šè¿‡é¢å¤–çš„é€‰é¡¹å¯ç”¨é«˜çº§åŠŸèƒ½ã€‚

- `scriptOptions` â€” ä¼ é€’ç»™è„šæœ¬çš„é™„åŠ é€‰é¡¹ã€‚è¯¦è§ [useScript é€‰é¡¹](/docs/api/use-script#scriptoptions)ã€‚
- `scriptInput` â€” ä¼ é€’ç»™è„šæœ¬çš„é™„åŠ è¾“å…¥ã€‚è¯¦è§ [useScript è¾“å…¥](/docs/api/use-script#scriptinput)ã€‚

```ts
import { useTimeout } from '@vueuse/core'
import { useScriptCloudflareWebAnalytics } from '#imports'

const { ready } = useTimeout(5000)
useScriptCloudflareWebAnalytics({
  token: '123',
  // ä¼ é€’ç»™ script å…ƒç´ çš„ HTML å±æ€§
  scriptInput: {
    'data-cf-test': 'true'
  },
  // ç”¨äºé«˜çº§åŠŸèƒ½çš„ useScript é€‰é¡¹
  scriptOptions: {
    trigger: ready,
    bundle: true,
  },
})
```

### åŠ è½½æœ€ä½³å®è·µ

å½“åœ¨å¤šä¸ªé¡µé¢æˆ–ç»„ä»¶ä¸­ä½¿ç”¨æ³¨å†Œè¡¨è„šæœ¬æ—¶ï¼Œå»ºè®®ä½ åœ¨ `app.vue` æˆ– `nuxt.config` ä¸­åˆå§‹åŒ–è„šæœ¬å¹¶ä¼ å…¥æ‰€éœ€é…ç½®ã€‚

åç»­å¯¹æ³¨å†Œè¡¨è„šæœ¬çš„è°ƒç”¨ä¼šä½¿ç”¨åŒä¸€ä¸ªè„šæœ¬å®ä¾‹ï¼Œä¸éœ€è¦å†æ¬¡ä¼ å…¥é€‰é¡¹ã€‚

::code-group

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  scripts: {
    registry: {
      // åŠ è½½è„šæœ¬
      fathomAnalytics: {
        site: 'SITE_ID',
      }
    }
  }
})
```

```vue [components/any-component.vue]
<script setup lang="ts">
const { proxy } = useScriptFathomAnalytics() // ä¸éœ€è¦ä¼ å…¥é€‰é¡¹
</script>

<template>
  <button @click="proxy.trackGoal('GOAL_ID')">
    è·Ÿè¸ªç›®æ ‡
  </button>
</template>
```

::

æˆ–è€…ï¼Œä½ å¯ä»¥å°†æ³¨å†Œè¡¨è„šæœ¬å°è£…æˆä¸€ä¸ª composable ä»¥ä¾¿æ›´æ–¹ä¾¿åœ°å®ä¾‹åŒ–è„šæœ¬ã€‚

```ts
export function useFathomAnalytics() {
  return useScriptFathomAnalytics({
    site: 'SITE_ID',
  })
}
```

## æ‰©å±•è„šæœ¬æ³¨å†Œè¡¨

ä½ å¯ä»¥åœ¨ `nuxt.config.ts` ä¸­ä½¿ç”¨ `scripts:registry` é’©å­æ‰©å±•è„šæœ¬æ³¨å†Œè¡¨ï¼š

```ts [nuxt.config.ts]
import { createResolver } from '@nuxt/kit'

const { resolve } = createResolver(import.meta.url)

export default defineNuxtConfig({
  modules: ['@nuxt/scripts'],

  hooks: {
    'scripts:registry': function (registry) {
      registry.push({
        category: 'custom',
        label: 'æˆ‘çš„è‡ªå®šä¹‰åˆ†æ',
        logo: '<svg>...</svg>', // å¯é€‰
        import: {
          name: 'useScriptMyAnalytics',
          from: resolve('./composables/useScriptMyAnalytics'),
        },
      })
    },
  },

  devtools: {
    enabled: true,
  },
})
```

ç„¶ååˆ›å»ºä½ çš„è‡ªå®šä¹‰è„šæœ¬ composableï¼š

```ts [composables/useScriptMyAnalytics.ts]
import { useRegistryScript } from '#nuxt-scripts/utils'
import { object, string } from '#nuxt-scripts-validator'

export interface MyAnalyticsApi {
  track: (event: string, data?: Record<string, any>) => void
  identify: (userId: string) => void
}

// ç”¨äºéªŒè¯å’Œ DevTools å…ƒæ•°æ®çš„ Schema
const MyAnalyticsSchema = object({
  apiKey: string(),
})

export function useScriptMyAnalytics<T extends MyAnalyticsApi>(options?: {
  apiKey: string
  scriptOptions?: NuxtUseScriptOptions
}) {
  return useRegistryScript<T, typeof MyAnalyticsSchema>('myAnalytics', () => ({
    scriptInput: {
      src: 'https://analytics.example.com/sdk.js',
    },
    scriptOptions: {
      ...options?.scriptOptions,
      use() {
        // åˆå§‹åŒ–è„šæœ¬
        window.MyAnalytics.init(options?.apiKey)
        return window.MyAnalytics as T
      },
    },
  }), options, { schema: MyAnalyticsSchema })
}
```

### ä½¿ç”¨è‡ªå®šä¹‰æ³¨å†Œè¡¨è„šæœ¬

æ³¨å†Œåï¼Œä½ çš„è‡ªå®šä¹‰è„šæœ¬ä½¿ç”¨æ–¹å¼ä¸å†…ç½®æ³¨å†Œè¡¨è„šæœ¬å®Œå…¨ç›¸åŒï¼š

```vue [pages/index.vue]
<script setup>
// ä»æ³¨å†Œè¡¨è‡ªåŠ¨å¯¼å…¥
const { proxy, status } = useScriptMyAnalytics({
  apiKey: 'your-api-key',
  scriptOptions: {
    trigger: 'onNuxtReady'
  }
})

// ä½¿ç”¨è„šæœ¬ API
function trackClick() {
  proxy.track('button_click', { button: 'hero-cta' })
}
</script>

<template>
  <button @click="trackClick">
    è·Ÿè¸ªæ­¤ç‚¹å‡»
  </button>
  <div>çŠ¶æ€: {{ status }}</div>
</template>
```

### DevTools é›†æˆ

å½“ä½ åŒ…å«éªŒè¯ Schema æ—¶ï¼ŒNuxt è„šæœ¬ä¼šè‡ªåŠ¨ç”¨ä½ çš„è„šæœ¬é…ç½®å¡«å…… DevTools å…ƒæ•°æ®ã€‚åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œ`registryKey` å’Œ `registryMeta` ä¼šè‡ªåŠ¨è®¾ç½®ï¼Œä½¿ä½ èƒ½å¤Ÿï¼š